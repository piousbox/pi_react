{"version":3,"sources":["../../../app/components/App/FbConnect.jsx"],"names":["MyFacebookButton","onClick","_CheckoutForm","props","state","handleSubmit","bind","e","preventDefault","console","log","stripe","createToken","then","payload","Object","assign","amount","profile","fetch","buyStars","method","headers","Headers","body","JSON","stringify","r","json","_data","dispatch","handleSuccess","Component","CheckoutForm","FbConnect","setState","showBuySuccess","showBuyMore","loggedIn","name","fbLogin","fbAppId","response","display","stripePublicKey","avatar","n_stars","star","mapStateToProps","ownProps"],"mappings":"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","file":"FbConnect.js","sourcesContent":["import React from 'react'\nimport { connect } from 'react-redux'\nimport { \n  StripeProvider, Elements, CardElement,\n  injectStripe,\n} from 'react-stripe-elements'\n\nimport {\n  Button, Modal,\n  Row, Col,\n} from 'react-bootstrap'\n\nimport avatar     from './images/avatars/2.jpg'\nimport star       from './images/32x32/star.png'\n\nimport FacebookAuth from 'react-facebook-auth'\n\nimport { profileAction, loginAction, logoutAction } from '../../actions'\n\nimport config from 'config'\n\nimport Center from '../Center'\n\nimport TgmApi from './TgmApi'\n\nconst MyFacebookButton = ({ onClick }) => (\n  <button onClick={onClick}>F</button>\n)\n\nclass _CheckoutForm extends React.Component {\n\n  constructor(props) {\n    super(props)\n    this.state = {\n    }\n    this.handleSubmit = this.handleSubmit.bind(this)\n  }\n  \n  handleSubmit (e) {\n    e.preventDefault()\n    console.log(\"+++ handlesubmit:\", e)\n    this.props.stripe.createToken().then((payload) => {\n\n      payload = Object.assign({}, payload, { amount: 500, \n                                             profile: this.props.profile })\n      console.log(\"+++ payload:\", payload)      \n\n      fetch(TgmApi.buyStars, {\n        method: 'POST',\n        headers: new Headers({\n          'Content-Type': 'application/json',\n        }),\n        body: JSON.stringify(payload)\n      }).then(r => r.json()).then(_data => {\n        console.log(\"+++ success!\", _data)\n        this.props.dispatch(profileAction())\n        this.props.handleSuccess()\n      })\n\n    })\n  }\n\n  render () {\n    console.log(\"+++ +++ _CheckoutForm:\", this.props, this.state)\n\n    return (\n      <form onSubmit={this.handleSubmit}>\n        <CardElement />\n        <Row>\n          <Col sm={4}>\n            <h1>$5</h1>\n          </Col>\n          <Col sm={4}>\n            <h1>$10</h1>\n          </Col>\n          <Col sm={4}>\n            <h1>$15</h1>\n          </Col>\n\n        </Row>\n        <Center><button>Buy Stars</button></Center>\n      </form>\n    )\n  }\n}\n\nconst CheckoutForm = injectStripe(_CheckoutForm)\n\nclass FbConnect extends React.Component {\n\n  constructor(props) {\n    super(props)\n    props.dispatch(profileAction())\n    this.state = { \n      profile: {},\n    }\n    this.handleSuccess = this.handleSuccess.bind(this)\n  }\n\n  handleSuccess (e) {\n    this.setState({ showBuySuccess: true, showBuyMore: false })\n  }\n\n  render () {\n    console.log(\"+++ +++ rendering FbConnect:\", this.props, this.state)\n\n    let loggedIn = !!(this.props.profile && this.props.profile.name)\n\n    let fbLogin = (<FacebookAuth appId={config.fbAppId} fields=\"name,email,picture\" \n                                 callback={(response) => {this.props.dispatch(loginAction(response))}} \n                                 component={MyFacebookButton} />)\n\n    if (loggedIn) {\n      return (\n        <div style={{ display: 'inline-block' }}>\n\n          <Modal show={this.state.showBuySuccess} onHide={() => { this.setState({ showBuySuccess: false }) }} >\n            <Modal.Header closeButton>\n              <Modal.Title>Thanks!</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n              <p>Your purchase went through, you should see the updated stars.</p>\n            </Modal.Body>\n            <Modal.Footer>\n              <Button onClick={() => { this.setState({ showBuySuccess: false }) }}>Close</Button>\n            </Modal.Footer>\n          </Modal>\n\n          <Modal show={this.state.showBuyMore} onHide={() => { this.setState({ showBuyMore: false }) }} >\n            <Modal.Header closeButton>\n              <Modal.Title>Buy Stars</Modal.Title>\n            </Modal.Header>\n            <Modal.Body>\n              <StripeProvider apiKey={config.stripePublicKey}>\n                <Elements>\n                  <CheckoutForm profile={this.props.profile} dispatch={this.props.dispatch} handleSuccess={this.handleSuccess} />\n                </Elements>\n              </StripeProvider>\n            </Modal.Body>\n            <Modal.Footer>\n              <Button onClick={() => { this.setState({ showBuyMore: false }) }}>Close</Button>\n            </Modal.Footer>\n          </Modal>\n\n          <img className=\"avatar\" src={ avatar } alt='' />\n          <h5>What's up { this.props.profile.name }</h5>\n          You have { this.props.profile.n_stars } <img style={{ display: 'inline' }} src={ star } alt='star' />&#39;s. \n          <Button onClick={ () => {this.setState({ showBuyMore: true })} }>Buy More</Button>\n          <button onClick={ () => {this.props.dispatch(logoutAction())} }>Logout</button>\n        </div>\n      )\n    } else {\n      return (\n        <div style={{ display: 'inline-block' }}>\n          { fbLogin }\n        </div>\n      )\n    }\n\n  }\n}\n\nfunction mapStateToProps(state, ownProps) {\n  return {\n    profile: state.profile,\n  }\n}\n\nexport default connect(mapStateToProps)(FbConnect)\n"]}