{"version":3,"sources":["../src/server.jsx"],"names":["Router","StaticRouter","store","reducer","thunk","NoMatch","React","Component","app","server","http","createServer","use","Express","static","exposedHeaders","config","corsHeaders","handleRender","req","res","console","log","params","qs","parse","query","html","url","finalState","getState","send","renderFullPage","preloadedState","staticDomain","JSON","stringify","replace","listen","process","env","PORT","port","address"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;;;AACA;;;;AACA;;AACA;;AACA;;AACA;;;;AACA;;AAIA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;;;;;;;AATA,IAAIA,SAASC,yBAAb;;AAWA,IAAMC,QAAQ,wBAAaC,kBAAb,EAAsB,4BAAiBC,oBAAjB,CAAtB,CAAd;;IAEMC,O;;;;;;;;;;;6BACM;AACR,aAAQ;AAAA;AAAA;AAAA;AAAA,OAAR;AACD;;;;EAHmBC,gBAAMC,S;;AAM5B,IAAIC,MAAM,wBAAV;AACAA,IAAIC,MAAJ,GAAaC,eAAKC,YAAL,CAAkBH,GAAlB,CAAb;AACAA,IAAII,GAAJ,CAAQC,kBAAQC,MAAR,CAAe,MAAf,CAAR;;AAEAN,IAAII,GAAJ,CAAQ,sBAAO,KAAP,CAAR,E,CAAuB;;AAEvBJ,IAAII,GAAJ,CAAQ,oBAAK;AACZG,kBAAgBC,iBAAOC;AADX,CAAL,CAAR;;AAIA,SAASC,YAAT,CAAsBC,GAAtB,EAA2BC,GAA3B,EAAgC;AAC9BC,UAAQC,GAAR,CAAY,mBAAZ;;AAEA,MAAMC,SAASC,aAAGC,KAAH,CAASN,IAAIO,KAAb,CAAf;AACA,MAAMC,OAAO,4BACX;AAAC,UAAD;AAAA,MAAQ,SAAS,EAAjB,EAAqB,UAAUR,IAAIS,GAAnC;AACE,kCAAC,aAAD;AADF,GADW,CAAb;;AAMA,MAAMC,aAAa3B,MAAM4B,QAAN,EAAnB;AACAV,MAAIW,IAAJ,CAASC,eAAeL,IAAf,EAAqBE,UAArB,CAAT;AACD;AACDrB,IAAII,GAAJ,CAAQM,YAAR;;AAEA,SAASc,cAAT,CAAwBL,IAAxB,EAA8BM,cAA9B,EAA8C;AAC5C,itBASqCjB,iBAAOkB,YAT5C,uFAYsBP,IAZtB,4PAgBuCQ,KAAKC,SAAL,CAAeH,cAAf,EAA+BI,OAA/B,CAAuC,IAAvC,EAA6C,SAA7C,CAhBvC;AAkDD;;AAED7B,IAAIC,MAAJ,CAAW6B,MAAX,CAAkBC,QAAQC,GAAR,CAAYC,IAAZ,IAAoBzB,iBAAO0B,IAA7C,EAAmD,YAAM;AACvDrB,UAAQC,GAAR,8BAAuCd,IAAIC,MAAJ,CAAWkC,OAAX,GAAqBD,IAA5D;AACD,CAFD;;kBAIelC,G","file":"server.js","sourcesContent":["import http       from 'http'\nimport Express    from 'express'\nimport cors       from 'cors'\nimport morgan     from 'morgan'\nimport bodyParser from 'body-parser'\nimport qs         from 'qs'\n\nimport React              from 'react'\nimport ReactDOM           from 'react-dom'\nimport { renderToString } from 'react-dom/server'\nimport { createStore, applyMiddleware } from 'redux'\nimport { Provider }       from 'react-redux'\nimport thunk              from 'redux-thunk'\nimport { matchPath, StaticRouter } from 'react-router'\n\nlet Router = StaticRouter\n\nimport config         from 'config'\nimport api            from './api'\nimport initializeDb   from './db'\nimport middleware     from './middleware'\nimport reducer        from './reducers'\nimport MainNavigation from './MainNavigation'\nimport routes         from './routes'\nimport App            from './App'\n\nconst store = createStore( reducer, applyMiddleware( thunk ) )\n\nclass NoMatch extends React.Component {\n  render () {\n    return (<div>no match</div>)\n  }\n}\n\nlet app = Express()\napp.server = http.createServer(app)\napp.use(Express.static('dist'))\n\napp.use(morgan('dev')) // logger\n\napp.use(cors({\n\texposedHeaders: config.corsHeaders\n}))\n\nfunction handleRender(req, res) {\n  console.log(\"+++ handleRender:\")\n\n  const params = qs.parse(req.query)\n  const html = renderToString(\n    <Router context={{}} location={req.url} >\n      <App />\n    </Router>\n  )\n\n  const finalState = store.getState()\n  res.send(renderFullPage(html, finalState))\n}\napp.use(handleRender)\n\nfunction renderFullPage(html, preloadedState) {\n  return `\n    <!doctype html>\n    <html>\n      <head>\n        <title>Annesque - Salsa Dance Studio in Santa Cruz</title>\n        <!-- Latest compiled and minified bootstrap CSS -->\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\" integrity=\"sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u\" crossorigin=\"anonymous\">\n        <!-- Optional bootstrap theme -->\n        <!-- <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css\" integrity=\"sha384-roN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp\" crossorigin=\"anonymous\"> -->\n        <link rel=\"stylesheet\" href=\"${config.staticDomain}/annesque.com/style.css\" >\n      </head>\n      <body>\n        <div id=\"app\">${html}</div>\n        <script>\n          // WARNING: See the following for security issues around embedding JSON in HTML:\n          // http://redux.js.org/recipes/ServerRendering.html#security-considerations\n          window.__PRELOADED_STATE__ = ${JSON.stringify(preloadedState).replace(/</g, '\\\\u003c')}\n        </script>\n        <script src=\"/client.js\"></script>\n\n        <!-- Global site tag (gtag.js) - Google Analytics -->\n        <script async src=\"https://www.googletagmanager.com/gtag/js?id=UA-47088821-4\"></script>\n        <script>\n          window.dataLayer = window.dataLayer || [];\n          function gtag(){dataLayer.push(arguments);}\n          gtag('js', new Date());\n          gtag('config', 'UA-47088821-4'); // _vp_ 20180503 20180517 annesque.com\n        </script>\n\n        <script>\n          function initMap() {\n            var myLatLng = {lat: 36.9694354, lng: -122.029866};\n            var map = new google.maps.Map(document.getElementById('map'), {\n              zoom: 15,\n              center: myLatLng\n            });\n            var marker = new google.maps.Marker({\n              position: myLatLng,\n              map: map,\n              title: 'Lauden Nelson Community Center'\n            });\n          }\n        </script>\n        <script async defer\n        src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyBz9MJTIs6pcyffyN5cbogsb9UT8q9xuxI&callback=initMap\">\n        </script>\n            \n      </body>\n    </html>\n  `\n}\n\napp.server.listen(process.env.PORT || config.port, () => {\n  console.log(`+++ +++ Started on port ${app.server.address().port}`)\n})\n\nexport default app\n"]}